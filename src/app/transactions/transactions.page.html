<ion-header [translucent]="true">
  <ion-toolbar>
    <div class="toolbar-content">

      <div id="calendar-div" >
        <ion-button id="calendar-btn" fill="clear" (click)="openCalendar()">
          <ion-icon name="calendar-outline" id="calendar-icon"></ion-icon>
        </ion-button>
        <ion-text id="selectedDate">{{selectedDate$ | async}}</ion-text>

      </div>

      <ion-label id="filter-label">Filter By:</ion-label>
      <ion-select interface="popover" (ionChange)="onFilterChange($event)" [(ngModel)]="selectedData" placeholder="Filter" id="filter-select">
        <ion-select-option value="All">All</ion-select-option>
        <ion-select-option value="Income">Income</ion-select-option>
        <ion-select-option value="Expense">Expense</ion-select-option>
      </ion-select>

     <ion-buttons slot="end">
        <ion-button fill="outline" id="profile-btn" routerLink="/profile">
          <ion-icon name="person-circle-outline" id="profile-icon"></ion-icon>
        </ion-button>
      </ion-buttons>

      
    </div>

    

  </ion-toolbar>
</ion-header>

<!-- Date Picker (Ion-Datetime with Custom Cancel and Done) -->
<!-- Date Picker Container -->
<div *ngIf="isDatePickerOpen" class="datetime-container" @fadeInOut>
  <div class="datetime-modal">
    <ion-datetime 
      [(ngModel)]="selectedDate"
      presentation="date"
      (ionChange)="onDateChange()">
    </ion-datetime>

    <div class="datetime-buttons">
      <ion-button fill="outline" (click)="closeDatePicker()">Cancel</ion-button>
    </div>
  </div>
</div>


<ion-content [fullscreen]="true">
 
  @if (!loading) {
    @if ((filteredData$ | async) ; as filteredData){

      @if (filteredData.length > 0){
        
        <ion-list lines="none" #listRef>
          <ion-item id="total">
           
            <div class="total">
            <div id="total-amount" class="amount-div">
              <ion-label class="amount">Total:
                <ion-text id="total-amount" [ngClass]="{'deficit': (totalAmount$ |async)! < 0, 'surplus': (totalAmount$ | async)! > 0}"> ${{toScientificNotation((totalAmount$ | async)!)}}</ion-text>
              </ion-label>
            </div>
            <div id="income-total" class="amount-div">
              <ion-label  class="amount" >Income:
                 <ion-text style="color: green;">${{toScientificNotation((totalIncome$ | async)!)}}</ion-text>
              </ion-label>
            </div>
            <div id="expense-total"class="amount-div">
              <ion-label  class="amount">Expense:
                <ion-text  style="color: red;">${{toScientificNotation((totalExpense$ | async)!)}}</ion-text>
              </ion-label>
            </div>
          </div>
            </ion-item>
          <ion-item *ngFor="let item of filteredData" 
                    [ngClass]="{
                      'expense-item': item.type === 'expense', 
                      'income-item': item.type === 'income'
                    }" lines="none">
            <div class="transaction-container">
              <ion-button id="delete-btn" fill="clear" color="danger" (click)="presentDeleteDialog(item)">
                <ion-icon id="delete-icon" name="trash" class="trans-icon"></ion-icon>
              </ion-button>
              <div id="amount-container">
              <ion-label class="amount" [ngClass]="{
                'expense-amount': item.type === 'expense', 
                'income-amount': item.type === 'income'
              }">{{ toScientificNotation(item.amount) }}$</ion-label>
              </div>
              <div class="category-container">
                <ion-icon id="category-icon" [src]="'assets/' + item.category.toLowerCase() + '.svg'" class="trans-icon"
                color="primary"></ion-icon>
                <ion-label class="category">{{ item.category }}</ion-label>
              </div>

              <div class="description-container">
                 <ion-label class="description"> {{ item.description }}</ion-label>
              </div>
              
          </div>
        </ion-item>
      </ion-list>
      } @else {
        <p id="noData">
         No data available</p>
      }
    }
  }
  @else {
    <ion-spinner name="crescent" id="spinner"></ion-spinner>
  }
  
  <ion-fab id="add-button" vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button routerLink="/add-transactions/expense" routerDirection="forward">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
  
 
 
  
 